{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="preload hidden">
        <div class="logo"></div>
        <div class="loader-frame">
            <div class="loader1" id="loader1"></div>
            <div class="loader2" id="loader2"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="portlet light estilosForm">
                <div class="portlet-title">
                    <div class="caption font-green">
                        <i class="fa fa-automobile font-green-sunglo"></i>
                        <span class="caption-subject bold uppercase"> AGREGAR TRANSPORTE</span>
                    </div>
                </div>
                <div class="portlet-body form">
                    <form role="form" id="addTransporte">
                        <div class="form-body">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">División</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-circle-o"></i>
												</span>
                                                <i style="color: #dc141b ; margin-right: 10px"
                                                   class="fa fa-exclamation tooltips hidden  addDivisionCentroCosto"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <select class="form-control input-group-sm" id="addDivisionCentroCosto"
                                                        name="addDivisionCentroCosto">
                                                    <option value="0">Seleccione ...
                                                    </option>
                                                    {% for division in  divisionCentrosCostos %}
                                                        <option value="{{ division.id }}">{{ division.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Centro de Costo</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-circle-o"></i>
												</span>
                                                <i style="color: #dc141b ; margin-right: 10px"
                                                   class="fa fa-exclamation tooltips hidden  addCentroCosto"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <select disabled class="form-control input-group-sm" id="addCentroCosto"
                                                        name="addCentroCosto">
                                                    <option id="inicio" value="0">Seleccione ...
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Marca-Modelo</label>
                                        <div class="col-md-9 ">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-circle-o"></i>
												</span>
                                                <i style="color: #dc141b ; margin-right: 10px"
                                                   class="fa fa-exclamation tooltips hidden  addModeloTransporte"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <select class="form-control input-group-sm" id="addModeloTransporte"
                                                        name="addModeloTransporte">
                                                    <option value="0">Seleccione ...</option>
                                                    {% for modelo in  modelosTransportes %}
                                                        <option value="{{ modelo.id }}">{{ modelo.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 20px">
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Tipo de
                                            Combustible</label>
                                        <div class="col-md-9 ">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-circle-o"></i>
												</span>
                                                <i style="color: #dc141b ; margin-right: 10px"
                                                   class="fa fa-exclamation tooltips hidden  addTipoCombustible"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <select class="form-control input-group-sm" id="addTipoCombustible"
                                                        name="addTipoCombustible">
                                                    <option value="0">Seleccione ...</option>
                                                    {% for tipo in  tiposCombustibles %}
                                                        <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">No. Activo Fijo</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-comment"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addNoActivoFijo"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control" placeholder="Teclee el no."
                                                       id="addNoActivoFijo" name="addNoActivoFijo">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Matrícula</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-tag"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addMatricula"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control"
                                                       placeholder="Teclee la matrícula"
                                                       id="addMatricula" name="addMatricula">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 20px">
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Año</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-tag"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addYear"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="number" min="1990" class="form-control"
                                                       placeholder="Teclee el año"
                                                       id="addYear" name="addYear">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Color</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-comment"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addColor"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control" placeholder="Teclee el color"
                                                       id="addColor" name="addColor">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Chasis</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-tag"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addChasis"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control" placeholder="Teclee el chasis"
                                                       id="addChasis" name="addChasis">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 20px">
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Motor</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-tag"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addMotor"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control" placeholder="Teclee el motor"
                                                       id="addMotor" name="addMotor">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Valor</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-comment"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addValor"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control" placeholder="Teclee el valor"
                                                       id="addValor" name="addValor">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Circulación</label>
                                        <div class="col-md-9">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-tag"></i>
												</span>
                                                <i style="color: #dc141b"
                                                   class="fa fa-exclamation tooltips hidden addCirculacion"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <input type="text" class="form-control"
                                                       placeholder="Teclee la circulación"
                                                       id="addCirculacion" name="addCirculacion">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 20px">
                                <div class="col-lg-4 col-md-4 col-sm-4">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label"></label>
                                        <div class="col-md-9">
                                            <div class="md-checkbox">
                                                <input type="checkbox" id="addLubricante" class="md-check">
                                                <label for="addLubricante">
                                                    <span></span>
                                                    <span class="check"></span>
                                                    <span class="box"></span>
                                                    LUBRICANTE </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4" style="display: none"
                                     id="mostrarTipoLubricante">
                                    <div class="form-group">
                                        <label class="col-md-3 control-label">Tipo de
                                            Aceite</label>
                                        <div class="col-md-9 ">
                                            <div class="input-group input-icon right">
												<span class="input-group-addon">
												<i class="fa fa-circle-o"></i>
												</span>
                                                <i style="color: #dc141b ; margin-right: 10px"
                                                   class="fa fa-exclamation tooltips hidden  addTipoLubricante"
                                                   data-placement="bottom"
                                                   data-original-title="Este campo es obligatorio"></i>
                                                <select class="form-control input-group-sm" id="addTipoLubricante"
                                                        name="addTipoLubricante">
                                                    <option value="0">Seleccione ...</option>
                                                    {% for tipo in  tiposLubricantes %}
                                                        <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-actions noborder">
                            <button type="button" class="btn btn-secondary" id="btnGuardar">Guardar</button>
                            <button type="button" class="btn btn default" id="btnSalir">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        jQuery(document).ready(function () {

            (function () {
                {% if not (is_granted("ROLE_NOMENCLADOR")) %}
                window.location.href = "{{ path('login') }}";
                {% else %}
                {% for nivel in app.user.nivelAccesos() if nivel == 'PLANTILLA_TRANSPORTE' %}
                {% else %}
                window.location.href = "{{ path('login') }}";
                {% endfor %}
                {% endif %}
            })();

            var lubricante = 0;

            //--------- abandonar el formulario -----------------
            $('#btnSalir').on('click', function () {
                window.location.href = "{{ path('gestionarTransportes') }}";
            });

            $('#addLubricante').on('change', function () {
                if ($('#addLubricante').prop('checked')) {
                    $('#mostrarTipoLubricante').css("display", "block");
                    lubricante = 1;
                } else {
                    $('#mostrarTipoLubricante').css("display", "none");
                    lubricante = 0;
                }
            });

            $('#addDivisionCentroCosto').on('change', function () {
                var html = '';
                var divisionCentroCosto = $('#addDivisionCentroCosto').val();
                if (divisionCentroCosto == '0') {
                    $("#addCentroCosto").prop('disabled', true);
                    $("option").remove('.cambioCentroCosto');
                } else {
                    $("option").remove('.cambioCentroCosto');
                    $("#inicio").after('<option class="cambioCentroCosto"></option>');

                    {% for centro in  centrosCostos %}
                    var idDivisionCentroCosto = '{{ centro.divisionCentroCosto.id }}';

                    if (idDivisionCentroCosto == divisionCentroCosto) {
                        var id = {{ centro.id }};
                        var name = '{{ centro.nombre }}';
                        html += '<option class="cambioCentroCosto" value="' + id + '">' + name + '</option>';

                    }
                    {% endfor %}
                    $(".cambioCentroCosto").replaceWith(html);
                    $("#addCentroCosto").prop('disabled', false);
                }
            });

            $('#btnGuardar').on('click', function () {

                //Validaciones
                var errores = 0;
                $('#addTransporte input[type=text]').each(function () {

                    var name = $(this).prop('name');
                    if ($(this).val().trim() == '') {
                        $(this).addClass('input-error');
                        $('.' + name).removeClass('hidden');
                        errores++;
                    } else {
                        $(this).removeClass('input-error');
                        $('.' + name).addClass('hidden');
                    }

                });

                $('#addTransporte input[type=number]').each(function () {

                    var name = $(this).prop('name');
                    if ($(this).val().trim() == '') {
                        $(this).addClass('input-error');
                        $('.' + name).removeClass('hidden');
                        errores++;
                    } else {
                        $(this).removeClass('input-error');
                        $('.' + name).addClass('hidden');
                    }
                });

                $('#addTransporte select').each(function () {

                    var name = $(this).prop('name');
                    if (name != 'addTipoLubricante') {
                        if ($(this).val() == '0') {
                            $(this).addClass('input-error');
                            $('.' + name).removeClass('hidden');
                            errores++;
                        } else {
                            $(this).removeClass('input-error');
                            $('.' + name).addClass('hidden');
                        }
                    }
                });

                if (errores !== 0) return false;

                if (lubricante === 1) {
                    if ($("#addTipoLubricante").val() === '0') {
                        alertify.alert('<strong>El tipo de aceite es obligatorio, no puede quedar en blanco.</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar');
                        return false;
                    }
                }

                $(".preload").removeClass('hidden');

                var mat_datos = {
                    matricula: $("#addMatricula").val().toUpperCase(),
                    year: $("#addYear").val(),
                    color: $("#addColor").val(),
                    chasis: $("#addChasis").val().toUpperCase(),
                    motor: $("#addMotor").val().toUpperCase(),
                    valor: $("#addValor").val(),
                    circulacion: $("#addCirculacion").val().toUpperCase(),
                    noActivoFijo: $("#addNoActivoFijo").val(),
                    centroCosto: $("#addCentroCosto").val(),
                    modeloTransporte: $("#addModeloTransporte").val(),
                    tipoCombustible: $("#addTipoCombustible").val(),
                    tipoLubricante: $("#addTipoLubricante").val(),
                    activo: 1,
                    lubricante: lubricante
                };
                $.ajax({
                    type: "POST",
                    dataType: "html",
                    url: '{{ path("insertTransporte") }}',
                    data: mat_datos
                }).done(function (data) {

                    $(".preload").addClass('hidden');
                    if (data === 'ok') {

                        alertify.alert('<strong>El medio de transporte ha sido insertado correctamente</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ok-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Confirmación</h4>')
                            .set('label', 'Aceptar')
                            .set('onok', function () {
                                window.location.href = "{{ path('gestionarTransportes') }}";
                            });
                    } else {
                        alertify.alert('<strong>' + data + '</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar')
                    }
                });

            });

        });
    </script>
{% endblock %}