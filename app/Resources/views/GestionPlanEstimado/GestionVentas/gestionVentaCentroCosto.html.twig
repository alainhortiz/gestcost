{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('easyadmin/tema/select2/select2-bootstrap.min.css') }}"/>
{% endblock %}

{% block info %}
    <div class="row counters">
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
            <div class="dashboard-stat  {{ totalEstimadoVenta == 0 ? 'grey' : 'green-haze' }}">
                <div class="visual">
                    <i class="fa fa-building"></i>
                </div>
                <div class="details">
                    <div class="number" data-toggle="counter-up" id="nameMontoEstimado">
                        {{ totalEstimadoVenta|number_format(0, '.', ',') }}
                    </div>
                    <div class="desc">
                        <strong>TOTAL ESTIMADO</strong>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-6">
            <div class="dashboard-stat {{ (totalEstimadoVenta - totalEstimadoCentroCostoVenta) == 0 ? 'grey' : 'grey-haze' }}"
                 id="nameMontoRestanteMostrar">
                <div class="visual">
                    <i class="fa fa-bank"></i>
                </div>
                <div class="details">
                    <div class="number" data-toggle="counter-up" id="nameMontoRestante">
                        {{ (totalEstimadoVenta - totalEstimadoCentroCostoVenta)|number_format(0, '.', ',') }}
                    </div>
                    <div class="desc">
                        <strong>ESTIMADO RESTANTE</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block body %}
    <div class="preload hidden">
        <div class="logo"></div>
        <div class="loader-frame">
            <div class="loader1" id="loader1"></div>
            <div class="loader2" id="loader2"></div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="portlet light estilosForm">
            <div class="portlet-title">
                <div class="caption font-green">
                    <i class="fa fa-folder-open font-green"></i>
                    <span class="caption-subject bold uppercase">PLAN DE VENTAS POR CENTRO DE COSTO</span>
                    <span id="nameSeccionHelp" class="caption-helper bold uppercase" id="year">{{ yearActivo }}</span>
                </div>
                <div class="tools">
                    {% if aprobadoEstimadoCentroCostoVenta == true %}
                    <a href="{{ path('exportarPlanEstimadoCentroCostoVenta') }}"
                       class="fa fa-file-excel-o fa-2x font-green"
                       data-toggle="tooltip" data-placement="left" title="Exportar a Excel">  </a>
                    {% endif %}
                    <a href="#" class="reload" id="btnAtrasVenta" data-placement="top"
                       data-original-title="Reiniciar">
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <ul class="nav nav-tabs nav-pills">
                    <li class="active">
                        <a href="#totalCentroCosto" data-toggle="tab">
                            PLAN POR CENTROS DE COSTOS - {{ divisionCentroCosto|upper }}</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade active in" id="totalCentroCosto">
                        <form role="form" id="formTotalCentroCosto">
                            <div class="form-body">
                                <div class="row">
                                    {% if aprobadoEstimadoCentroCostoVenta == false %}
                                        <div class="col-lg-3 col-md-3 col-sm-3">
                                            <div class="portlet">
                                                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top: 40px">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="mesCentroCosto"
                                                                name="mesCentroCosto">
                                                            <option value="0">Seleccione ...</option>
                                                            {% for mes in  mesesCentrosCostos %}
                                                                <option value="{{ mes.mes }}">{{ mes.mes }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <label for="mesCentroCosto">MES</label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top: 20px">
                                                    <div class="form-group form-md-line-input">
                                                        <select class="form-control" id="centroCosto"
                                                                name="centroCosto" disabled>
                                                            <option value="0">Seleccione ...</option>
                                                            {% for centro in  centrosCostos %}
                                                                <option value="{{ centro.id }}">{{ centro.nombre }}</option>
                                                            {% endfor %}
                                                        </select>
                                                        <label for="centroCosto">CENTRO DE COSTO</label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12 col-md-12 col-sm-12" style="margin-top: 20px">
                                                    <div class="form-group form-md-line-input input-icon right">
                                                        <i style="color: #111111"></i>
                                                        <input type="text" class="form-control" onkeypress="return filterFloat(event,this);"
                                                               id="totalVentaComercial"
                                                               name="totalVentaComercial" disabled>
                                                        <label for="totalVentaComercial">TOTAL DE PRESUPUESTO</label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-12" style="margin-top: 20px">
                                                    <div class="form-actions noborder">
                                                        <button type="button"
                                                                class="btn btn-secondary Asignar" {{ (totalEstimadoVenta - totalEstimadoCentroCostoVenta) == 0 ? 'disabled' }}>
                                                            Asignar
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-12" style="margin-top: 20px">
                                                    <div class="form-actions noborder">
                                                        <button type="button" class="btn btn-secondary Modificar"
                                                                disabled>
                                                            Modificar
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-12" style="margin-top: 20px">
                                                    <div class="form-actions noborder">
                                                        <button type="button"
                                                                class="btn btn-secondary AprobarCentroCostoVenta" {{ estadosMeses['estadoTotal'] != 1200 ? 'disabled' }} >
                                                            Aprobar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class="{{ aprobadoEstimadoCentroCostoVenta == false ? 'col-lg-9 col-md-9 col-sm-9' : 'col-lg-12 col-md-12 col-sm-12' }}"
                                         style="overflow-y:auto;margin-top: 20px">
                                        <div class="portlet chart" style="margin-top: 20px" id="progresoDistribucion">
                                            <span class="caption-subject bold uppercase"
                                                  style="font-size: 19px;color: #005850">
                                                {{ aprobadoEstimadoCentroCostoVenta == false ? 'ESTADO DE LA DISTRIBUCIÓN MENSUAL' : 'DISTRIBUCIÓN MENSUAL APROBADA' }}
                                            </span>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">ENERO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoEnero'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoEnero'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoEnero'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">FEBRERO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoFebrero'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoFebrero'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoFebrero'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">MARZO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoMarzo'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoMarzo'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoMarzo'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">ABRIL</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoAbril'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoAbril'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoAbril'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">MAYO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoMayo'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoMayo'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoMayo'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">JUNIO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoJunio'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoJunio'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoJunio'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">JULIO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoJulio'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoJulio'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoJulio'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">AGOSTO</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoAgosto'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoAgosto'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoAgosto'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">SEPTIEMBRE</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoSeptiembre'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoSeptiembre'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoSeptiembre'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">OCTUBRE</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoOctubre'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoOctubre'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoOctubre'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">NOVIEMBRE</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoNoviembre'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoNoviembre'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoNoviembre'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-12 col-sm-12" style="margin-top: 10px">
                                                    <label for="totalVentaComercial">DICIEMBRE</label>
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar {{ estadosMeses['estadoDiciembre'] == 100 ? 'progress-bar-success' : 'progress-bar-danger' }}"
                                                             role="progressbar"
                                                             aria-valuenow="40"
                                                             aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {{ estadosMeses['estadoDiciembre'] }}%">
                                                            <span class="sr-only-focusable">{{ estadosMeses['estadoDiciembre'] }}% DISTRIBUCIÓN MENSUAL  </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="portlet chart" style="margin-top: 20px; display:none"
                                             id="graficoVentasCentrosCostos"></div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- BEGIN GRAFICOS HIGHSTOCK LEVEL PLUGINS -->
    <script src="{{ asset('easyadmin/plugins/highstock/code/highstock.js') }}"></script>
    <script src="{{ asset('easyadmin/plugins/highstock/code/modules/annotations.js') }}"></script>
    <script src="{{ asset('easyadmin/plugins/highstock/code/modules/exporting.js') }}"></script>
    <script src="{{ asset('easyadmin/plugins/highstock/code/modules/export-data.js') }}"></script>
    <script src="{{ asset('easyadmin/plugins/highstock/code/modules/export-clientside.js') }}"></script>
    <!-- END  GRAFICOS HIGHSTOCK LEVEL PLUGINS -->
    <script src="{{ asset('easyadmin/plantilla1/js/waypoints.min.js') }}"></script>
    <script src="{{ asset('easyadmin/plantilla1/js/counterup.min.js') }}"></script>
    <script src="{{ asset('easyadmin/tema/select2/select2.full.min.js') }}"></script>
    <script>
        $(document).ready(function () {

            (function () {
                {% if not (app.session.get('aprobarEstimadoVentaMes')) and is_granted("ROLE_DISTRIBUIDOR_CENTRO") %}
                window.location.href = "{{ path('login') }}";
                {% else %}
                {% for nivel in app.user.nivelAccesos() if nivel == 'ESTIMADO_VENTAS' %}
                {% else %}
                window.location.href = "{{ path('login') }}";
                {% endfor %}
                {% endif %}
            })();

            // jQuery counterUp
            $('[data-toggle="counter-up"]').counterUp({
                delay: 10,
                time: 1000
            });

            //--------- abandonar el formulario -----------------
            $('.salir').on('click', function () {
                window.location.href = "{{ path('inicio') }}";

            });

            $('#btnAtrasVenta').on("click", function () {
                window.location.href = "{{ path('gestionarEstimadoPlanVentasCentroCosto') }}";
            });

            //funciones de asigancion del presupuesto por centros de costos

            //Declaracion de variables
            var totalEstimadoVentaCentroCostoMes = [];
            var montoRestante = 0;
            var montoRestanteCentroCosto = 0;
            var montoAnterior = 0;
            var centroCosto = '';
            var idCentroCosto = '';
            var n;
            var mes;
            var totalMes = 0;
            var totalRestanteMes = 0;

            $('#mesCentroCosto').on('change', function () {
                if ($('#mesCentroCosto').val() !== '0') {
                    //mostrar el total del presupuesto del mes seleccionado
                    {% for mes in mesesCentrosCostos %}
                    mes = '{{ mes.mes }}';
                    if ($('#mesCentroCosto').val() === mes) {
                        totalMes = {{ mes.presupuesto }};
                        $('#nameMontoEstimado').text('{{ mes.presupuesto|number_format(0, '.', ',') }}');
                    }
                    {% endfor %}
                    totalRestanteMes = 0;
                    totalEstimadoVentaCentroCostoMes = [];
                    {% for total in totalEstimadoMesCentroCostoVenta %}
                    mes = '{{ total.mes }}';
                    if ($('#mesCentroCosto').val() === mes) {
                        totalRestanteMes += parseFloat('{{ total.presupuesto }}');
                        totalEstimadoVentaCentroCostoMes.push({
                            name: '{{ total.centro }}',
                            y: parseInt('{{ total.presupuesto }}')
                        });
                    }
                    {% endfor %}
                    $('#progresoDistribucion').css("display", "none");
                    $('#graficoVentasCentrosCostos').css("display", "block");
                    graficoTotalEstimadoVentaCentroCosto();
                    totalRestanteMes = totalMes - totalRestanteMes;
                    $('#nameMontoRestante').text(Highcharts.numberFormat(totalRestanteMes, 0, '.', ','));

                    if (totalRestanteMes === 0) {
                        $('.Asignar').prop("disabled", true);
                        /*$('.AprobarCentroCostoVenta').prop("disabled", false);*/
                        $('#centroCosto').prop("disabled", true);
                    } else {
                        $('#centroCosto').prop("disabled", false);
                    }
                } else {
                    $('#nameMontoEstimado').text('{{ totalEstimadoVenta|number_format(0, '.', ',') }}');
                    $('#nameMontoRestante').text('{{ (totalEstimadoVenta - totalEstimadoCentroCostoVenta)|number_format(0, '.', ',') }}');
                    $('#centroCosto').prop("disabled", true);
                    $('#graficoVentasCentrosCostos').css("display", "none");
                    $('#progresoDistribucion').css("display", "block");
                }
            });

            $('#centroCosto').on('change', function () {
                if ($('#centroCosto').val() !== '0') {
                    $('#totalVentaComercial').prop("disabled", false);
                } else {
                    $('#totalVentaComercial').prop("disabled", true);
                }
            });

            //Cargar el presupuesto estimado del centro de costo seleccionada
            function cargarCentroCosto(categoria, presupuesto, colorSeleccionado) {

                //mostrar el total del presupuesto
                {% for centro in centrosCostos %}
                centroCosto = '{{ centro.nombre }}';
                if (centroCosto === categoria) {
                    $('#centroCosto').val('{{ centro.id }}');
                    idCentroCosto = {{ centro.id }};
                }
                {% endfor %}

                $('#totalVentaComercial').val(presupuesto);
                montoAnterior = parseInt(presupuesto);
                $('#centroCosto').prop("disabled", false);
                $('#totalVentaComercial').prop("disabled", false);
                $('.Asignar').prop("disabled", true);
                $('.Modificar').prop("disabled", false);
                /* $('.AprobarCentroCostoVenta').prop("disabled", true);*/

            }

            //Grafico general Total presupuesto Estimado por categorías
            function graficoTotalEstimadoVentaCentroCosto() {
                var valorMax = totalEstimadoVentaCentroCostoMes.length - 1;
                var valorScrollbar = false;
                if (totalEstimadoVentaCentroCostoMes.length > 6) {
                    valorMax = 5;
                    valorScrollbar = true;
                }
                Highcharts.chart('graficoVentasCentrosCostos', {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: null
                    },
                    exporting: {
                        enabled: false
                    },
                    scrollbar: {
                        enabled: valorScrollbar,
                        liveRedraw: true,
                        step: 1
                    },
                    xAxis: {
                        type: 'category',
                        min: 0,
                        max: valorMax,
                        useHTML: true
                    },
                    yAxis: {
                        title: {
                            text: 'Presupuesto Estimado',
                            useHTML: true
                        }

                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        series: {
                            borderWidth: 0,
                            allowPointSelect: true,
                            cursor: 'pointer',
                            getExtremesFromAll: true,
                            dataLabels: {
                                enabled: true,
                                formatter: function () {
                                    return Highcharts.numberFormat(this.y, 0, ',', '.');
                                }
                            }
                        }
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                        pointFormat: '<span style="color:{point.color}">{point.name}</span>' + ' presupuesto asignado ' + '<b>{point.y:,.0f}</b>'
                    },

                    "series": [
                        {
                            "name": "Categorías",
                            "colorByPoint": true,
                            "data": totalEstimadoVentaCentroCostoMes,
                            events: {
                                click: function (oEvent) {
                                    cargarCentroCosto(oEvent.point.name, oEvent.point.y, oEvent.point.color);
                                }
                            }
                        }
                    ],
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 500
                            },
                            chartOptions: {
                                scrollbar: {
                                    enabled: true
                                },
                                xAxis: {
                                    min: 0,
                                    max: 1,
                                    useHTML: true
                                }
                            }
                        }]
                    }
                });
            }

            $('.Asignar').on('click', function () {

                if ($("#mesCentroCosto").val() === '0') {
                    alertify.alert('<strong>El mes es obligatorio, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if ($("#centroCosto").val() === '0') {
                    alertify.alert('<strong>El centro de costo es obligatoria, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if ($("#totalVentaComercial").val() === '') {
                    alertify.alert('<strong>El total de presupuesto es obligatorio, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if (parseInt($("#totalVentaComercial").val()) > totalRestanteMes) {
                    alertify.alert('<strong>El total de presupuesto no puede ser mayor que el monto restante.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                $(".preload").removeClass('hidden');

                var mat_datos = {
                    presupuesto: $("#totalVentaComercial").val(),
                    idPlanEstimado: {{ planEstimado }},
                    centroCosto: $("#centroCosto").val(),
                    idDivisionCentroCosto: {{ idDivisionCentroCosto }},
                    mes: $("#mesCentroCosto").val()
                };
                $.ajax({
                    type: "POST",
                    dataType: "html",
                    url: '{{ path("insertTotalEstimadoCentroCostoVenta") }}',
                    data: mat_datos
                }).done(function (data) {

                    $(".preload").addClass('hidden');
                    if (data === 'ok') {

                        alertify.alert('<strong>El plan mensual estimado para este centro de costo ha asignado correctamente</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ok-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Confirmación</h4>')
                            .set('label', 'Aceptar')
                            .set('onok', function () {
                                window.location.href = "{{ path('gestionarEstimadoPlanVentasCentroCosto') }}";
                            });
                    } else {
                        alertify.alert('<strong>' + data + '</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar')
                    }
                });

            });

            $('.Modificar').on('click', function () {

                if ($("#mesCentroCosto").val() === '0') {
                    alertify.alert('<strong>El mes es obligatorio, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if ($("#centroCosto").val() === '0') {
                    alertify.alert('<strong>El centro de costo es obligatorio, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if ($("#totalVentaComercial").val() === '') {
                    alertify.alert('<strong>El total de presupuesto es obligatorio, no puede quedar en blanco.</strong>')
                        .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                            '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                        .set('label', 'Aceptar');
                    return false;
                }

                if (totalRestanteMes === 0) {
                    if (parseInt($("#totalVentaComercial").val()) > montoAnterior) {
                        alertify.alert('<strong>El total de presupuesto no puede ser mayor que el monto disponible.</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar');
                        return false;
                    }
                } else {
                    if (parseInt($("#totalVentaComercial").val()) > (montoAnterior + totalRestanteMes)) {
                        alertify.alert('<strong>El total de presupuesto no puede ser mayor que el monto restante.</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar');
                        return false;
                    }
                }

                $(".preload").removeClass('hidden');

                var mat_datos = {
                    presupuesto: $("#totalVentaComercial").val(),
                    idPlanEstimado: {{ planEstimado }},
                    centroCosto: $("#centroCosto").val(),
                    idDivisionCentroCosto: {{ idDivisionCentroCosto }},
                    mes: $("#mesCentroCosto").val()
                };
                $.ajax({
                    type: "POST",
                    dataType: "html",
                    url: '{{ path("updateTotalEstimadoCentroCostoVenta") }}',
                    data: mat_datos
                }).done(function (data) {

                    $(".preload").addClass('hidden');
                    if (data === 'ok') {

                        alertify.alert('<strong>El plan mensual estimado de este centro de costo ha sido modificado correctamente</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ok-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Confirmación</h4>')
                            .set('label', 'Aceptar')
                            .set('onok', function () {
                                $('#centroCosto').prop("disabled", false);
                                if (montoRestante !== 0) {
                                    $('.Asignar').prop("disabled", false);
                                }
                                window.location.href = "{{ path('gestionarEstimadoPlanVentasCentroCosto') }}";
                            });
                    } else {
                        alertify.alert('<strong>' + data + '</strong>')
                            .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                            .set('label', 'Aceptar')
                    }
                });

            });

            $('.AprobarCentroCostoVenta').on('click', function () {

                alertify.confirm('Basic: false').set('message', '<strong>Seguro que desea aprobar la distribución del plan mensual para los centros de costos de esta división</strong>').set('onok', function () {

                    $(".preload").removeClass('hidden');

                    var mat_datos = {
                        idPlanEstimado: {{ app.session.get('idPlanEstimado') }},
                        idDivisionCentroCosto: {{ idDivisionCentroCosto }}
                    };
                    $.ajax({
                        type: "POST",
                        dataType: "html",
                        url: '{{ path("aprobarPresupuestoEstimadoCentroCostoVenta") }}',
                        data: mat_datos
                    }).done(function (data) {

                        $(".preload").addClass('hidden');
                        if (data === 'ok') {

                            alertify.alert('<strong>Se aprobó el plan mensual estimado de ventas para los centros de costos de esta división</strong>')
                                .setHeader('<span class="glyphicon glyphicon-ok-circle" style="font-size: 20px"></span>' +
                                    '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Confirmación</h4>')
                                .set('label', 'Aceptar')
                                .set('onok', function () {
                                    window.location.href = "{{ path('gestionarEstimadoPlanVentasCentroCosto') }}";
                                });
                        } else {
                            alertify.alert('<strong>' + data + '</strong>')
                                .setHeader('<span class="glyphicon glyphicon-ban-circle" style="font-size: 20px"></span>' +
                                    '<h4 class="modal-title" style="display: inline-block; margin-left: 10px">Error</h4>')
                                .set('label', 'Aceptar')
                        }
                    });
                });

            });

            //fin asignacion del presupuesto total por centro de costo


        });
    </script>
{% endblock %}