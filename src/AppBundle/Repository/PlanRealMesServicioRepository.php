<?php

namespace AppBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * PlanRealMesServicioRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PlanRealMesServicioRepository extends EntityRepository
{
    public function datosServiciosRecibidos($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

    public function datosServiciosRecibidosMeses($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT prm.mes, o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY prm.mes, o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

    public function datosServiciosRecibidosDivision($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT d.nombre AS division, o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.centroCosto c
                JOIN c.divisionCentroCosto d
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY d.nombre,o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

    public function datosServiciosRecibidosDivisionMeses($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT prm.mes, d.nombre AS division, o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.centroCosto c
                JOIN c.divisionCentroCosto d
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY prm.mes,d.nombre,o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

    public function datosServiciosRecibidosCentroCosto($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT c.nombre AS centro, o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.centroCosto c
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY c.nombre,o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

    public function datosServiciosRecibidosCentroCostoMeses($idReal)
    {
        $em = $this->getEntityManager();

        $dql = 'SELECT prm.mes, c.nombre AS centro, o.nombre AS servicio, SUM(prms.total) AS total
                FROM AppBundle:PlanRealMesServicio prms
                JOIN prms.otroGasto o
                JOIN prms.planRealMes prm
                JOIN prm.centroCosto c
                JOIN prm.planReal pr
                WHERE pr.id = :p1
                GROUP BY prm.mes,c.nombre,o.nombre';

        $query = $em->createQuery($dql);
        $query->setParameter('p1', $idReal);

        return $query->getResult();

    }

}
